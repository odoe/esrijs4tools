{"version":3,"sources":["src/Edit.js"],"names":[],"mappings":"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","file":"src/Edit.js","sourcesContent":["import * as esriRequest from 'esri/request';\nimport * as GraphicsLayer from 'esri/layers/GraphicsLayer';\n\nclass Edit {\n  cache: []\n\n  constructor(params) {\n    this.map = params.map;\n    this.layer = params.layer;\n    this.dummyLayer = new GraphicsLayer();\n    this.map.add(this.dummyLayer);\n  }\n\n  _edit(graphic, type) {\n    let usePost = true;\n    let action = `/${type.toLowerCase()}Features`;\n    let data = graphic.toJSON();\n    let map = this.map;\n    let layer = this.layer;\n    let url = layer.url + action;\n    map.remove(layer);\n    this.dummyLayer.clear();\n    esriRequest({\n      url,\n      content: {\n        features: JSON.stringify([data]),\n        f: 'json'\n      },\n      handleAs: 'json'\n    }, { usePost })\n    .then(_ => map.add(layer))\n    .otherwise(_ => map.add(layer));\n  }\n\n  add(graphic, immediate = true) {\n    if (immediate) {\n      this._edit(graphic, 'add');\n    } else {\n      this.cache.push({ type: 'add', graphic });\n      this.dummyLayer.add(graphic);\n    }\n  }\n\n  update(graphic, immediate = true) {\n    if(immediate) {\n      this._edit(graphic, 'update');\n    } else {\n      this.cache.push({ type: 'add', graphic });\n      this.dummyLayer.add(graphic);\n    }\n  }\n\n  del(graphic, immediate = true) {\n    if(immediate) {\n      this._edit(graphic, 'delete');\n    } else {\n      this.cache.push({ type: 'delete', graphic });\n      this.dummyLayer.add(graphic);\n    }\n  }\n\n  save() {\n    if (this.cache.length) {\n      this.cache.map(x => this._edit(x.graphic, x.type));\n      this.dummyLayer.clear();\n      this.cache.length = 0;\n    }\n  }\n}\n\nexport default Edit;\n"]}